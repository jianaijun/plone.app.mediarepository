<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<div metal:fill-slot="content-core"
     tal:define="media view/queryMediaRepository;
                 tags python:view.getSearchTagsFromResults(media);
                 Batch python:modules['Products.CMFPlone'].Batch;
                 b_start python:request.get('b_start', 0);
                 batch python:Batch(media, view.b_size, int(b_start), orphan=view.b_orphan);">

<script type="text/javascript" charset="utf-8">
    jQuery(function($) {
        $().ready(function () {
            $("#media-tag-filter").change(function() {
                window.location.href = $(":selected", this).val();
            });

            $('.photoAlbumEntry img')
                .prepOverlay({
                    subtype: 'image',
                    urlmatch: '/@@images/.+$',
                    urlreplace: ''
                    });
        });
    });
</script>

    <tal:tags>
        <select style="float: right; clear: right"
                id="media-tag-filter"
                tal:condition="tags">
            <option value="" i18n:translate="label_only_these_tags">Only show items with tag&hellip;</option>
            <option
                    value=""
                    i18n:translate="label_no_tags"
                    tal:attributes="value python: '%s?%s' % (context.absolute_url(), view.makeMediaRepositoryQuery(data=request.form, add={'tags':['']}))"
                    >[no tags]</option>
            <tal:block tal:repeat="tag tags">
                <option
                    i18n:translate=""
                    tal:content="tag"
                    tal:attributes="value python: '%s?%s' % (context.absolute_url(), view.makeMediaRepositoryQuery(data=request.form, add={'tags':[tag]}))"
                    />
            </tal:block>
        </select>

        <div tal:define="request_tags request/tags|nothing"
             tal:condition="request_tags">
            <label i18n:translate="label_tag_filter">Filter:</label>
            <tal:block tal:repeat="tag request_tags">
                <tal:tag tal:replace="tag" />
                <a href=""
                   title="Remove this tag from search"
                   tal:attributes="href python: '%s?%s' % (context.absolute_url(), view.makeMediaRepositoryQuery(data=request.form, omit={'tags':[tag]}))"
                    >(-)</a>
                <tal:arrow tal:condition="not:repeat/tag/end">
                    &rarr;
                </tal:arrow>
            </tal:block>
        </div>

        <div class="visualClear"><!-- --></div>
    </tal:tags>

    <div tal:condition="media" metal:use-macro="context/batch_macros/macros/navigation" />

    <tal:media metal:define-macro="media"
                tal:condition="batch"
                tal:repeat="item batch">
        <div class="photoAlbumEntry">
            <a tal:define="id python:int(b_start)+int(repeat['item'].number()-1);
                           obj item/getObject;"
               tal:attributes="href string:${item/getURL}/view;
                               title item/Description">
                <span class="photoAlbumEntryWrapper">
                    <img tal:replace="structure obj/@@images/image/thumb | nothing" />
                </span>
                <span class="photoAlbumEntryTitle" tal:content="item/pretty_title_or_id">
                   Title
                </span>
            </a>
        </div>
    </tal:media>

    <div class="visualClear"><!-- --></div>

    <p class="discreet"
       i18n:translate="text_no_media_uploaded"
       tal:condition="not:media">
        No media uploaded yet.
    </p>

    <div tal:condition="media" metal:use-macro="context/batch_macros/macros/navigation" />

</div>

</body>
</html>
